// Prisma schema for ICONIC LOGISTICS CMS
// Using self-hosted PostgreSQL for production deployment

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL") // For migrations (same as DATABASE_URL for self-hosted)
}

enum Role {
  SUPER_ADMIN // Toàn quyền: quản lý users, toàn bộ nội dung
  ADMIN       // Quản lý nội dung: posts, services, company info
  EDITOR      // Chỉnh sửa nội dung: tạo/sửa posts (draft), services
  VIEWER      // Chỉ xem: read-only access
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  passwordHash String   @map("password_hash")
  role         Role     @default(ADMIN)
  active       Boolean  @default(true)
  lastLoginAt  DateTime? @map("last_login_at")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  posts        Post[]

  @@map("users")
}

model Post {
  id            String    @id @default(cuid())
  slug          String    @unique
  title         String
  summary       String?
  coverImageUrl String?   @map("cover_image_url")
  contentMd     String    @map("content_md") @db.Text
  status        String    @default("DRAFT")
  publishedAt   DateTime? @map("published_at")
  createdById   String    @map("created_by_id")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  createdBy     User      @relation(fields: [createdById], references: [id])

  @@index([status, publishedAt])
  @@index([slug])
  @@map("posts")
}

model Service {
  id          String   @id @default(cuid())
  slug        String   @unique
  title       String
  description String
  content     String?  @db.Text
  icon        String?
  sortOrder   Int      @default(0) @map("sort_order")
  visible     Boolean  @default(true)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([visible, sortOrder])
  @@map("services")
}

model CompanyInfo {
  id          String   @id @default(cuid())
  nameVi      String   @map("name_vi")
  nameEn      String   @map("name_en")
  phone       String
  email       String
  address     String
  introduction String?   @db.Text
  vision      String   @db.Text
  mission     String   @db.Text
  coreValues  String?   @db.Text @map("core_values")
  goals       String?   @db.Text
  commitments String?   @db.Text
  strengths   String?   @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("company_info")
}

model Partner {
  id        String   @id @default(cuid())
  name      String
  port      String?
  type      String   @default("SHIPPING") // SHIPPING, AIRLINE, INTERNATIONAL
  sortOrder Int      @default(0) @map("sort_order")
  visible   Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([visible, sortOrder])
  @@map("partners")
}

model Commodity {
  id        String   @id @default(cuid())
  nameVi    String   @map("name_vi")
  nameEn    String?  @map("name_en")
  sortOrder Int      @default(0) @map("sort_order")
  visible   Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([visible, sortOrder])
  @@map("commodities")
}

model Media {
  id        String   @id @default(cuid())
  filename  String
  url       String
  alt       String?
  width     Int?
  height    Int?
  size      Int?
  mimeType  String?  @map("mime_type")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("media")
}

model ContactForm {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  company   String?
  message   String   @db.Text
  createdAt DateTime @default(now()) @map("created_at")

  @@map("contact_forms")
}
